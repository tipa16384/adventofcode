
# these coords are in x,y, with increasing y going up, increasing x going right
keypad_1 = { ' ': (0,0), '0': (1,0), 'A': (2,0), '1': (0,1), '2': (1,1), '3': (2,1), '4': (0,2), '5': (1,2), '6': (2,2), '7': (0,3), '8': (1,3), '9': (2,3) }
keypad_2 = { '<': (0,0), 'v': (1,0), '>': (2,0), ' ': (0,1), '^': (1,1), 'A': (2,1) }

keypad_move_map = {
    ('A', 'A'): '',
    ('A', '0'): '<',
    ('A', '1'): '^<<',
    ('A', '2'): '^<',
    ('A', '3'): '^',
    ('A', '4'): '^^<<',
    ('A', '5'): '<^^',
    ('A', '6'): '^^',
    ('A', '7'): '^^^<<',
    ('A', '8'): '<^^^',
    ('A', '9'): '^^^',
    ('0', 'A'): '>',
    ('0', '1'): '^<',
    ('0', '2'): '^',
    ('0', '3'): '^>',
    ('0', '4'): '^^<',
    ('0', '5'): '^^',
    ('0', '6'): '^^>',
    ('0', '7'): '^^^<',
    ('0', '8'): '^^^',
    ('0', '9'): '^^>',
    ('1', 'A'): '>>v',
    ('1', '0'): '>v',
    ('1', '1'): '',
    ('1', '2'): '>',
    ('1', '3'): '>>',
    ('1', '4'): '^',
    ('1', '5'): '^>',
    ('1', '6'): '^>>',
    ('1', '7'): '^^',
    ('1', '8'): '^^>',
    ('1', '9'): '^^>>',
    ('2', 'A'): 'v>',
    ('2', '0'): 'v',
    ('2', '1'): '<',
    ('2', '2'): '',
    ('2', '3'): '>',
    ('2', '4'): '^<',
    ('2', '5'): '^',
    ('2', '6'): '^>',
    ('2', '7'): '^^<',
    ('2', '8'): '^^',
    ('2', '9'): '^^>',
    ('3', 'A'): 'v',
    ('3', '0'): 'v<',
    ('3', '1'): '<<',
    ('3', '2'): '<',
    ('3', '3'): '',
    ('3', '4'): '^<<',
    ('3', '5'): '^<',
    ('3', '6'): '^',
    ('3', '7'): '<<^^',
    ('3', '8'): '^^<',
    ('3', '9'): '^^',
    ('4', 'A'): '>>vv',
    ('4', '0'): '>>vv',
    ('4', '1'): 'v',
    ('4', '2'): '>v',
    ('4', '3'): '>>v',
    ('4', '4'): '',
    ('4', '5'): '>',
    ('4', '6'): '>>',
    ('4', '7'): '^',
    ('4', '8'): '^>',
    ('4', '9'): '^>>',
    ('5', 'A'): 'vv>',
    ('5', '0'): 'vv',
    ('5', '1'): '<v',
    ('5', '2'): 'v',
    ('5', '3'): '>v',
    ('5', '4'): '<',
    ('5', '5'): '',
    ('5', '6'): '>',
    ('5', '7'): '^<',
    ('5', '8'): '^',
    ('5', '9'): '^>',
    ('6', 'A'): 'vv',
    ('6', '0'): 'vv',
    ('6', '1'): '<<v',
    ('6', '2'): '<v',
    ('6', '3'): 'v',
    ('6', '4'): '<<',
    ('6', '5'): '<',
    ('6', '6'): '',
    ('6', '7'): '^<<',
    ('6', '8'): '^<',
    ('6', '9'): '^',
    ('7', 'A'): '>>vvv',
    ('7', '0'): '>>vvv',
    ('7', '1'): 'vv',
    ('7', '2'): '>vv',
    ('7', '3'): '>>vv',
    ('7', '4'): 'v',
    ('7', '5'): '>v',
    ('7', '6'): '>>v',
    ('7', '7'): '',
    ('7', '8'): '>',
    ('7', '9'): '>>',
    ('8', 'A'): '>vvv',
    ('8', '0'): 'vvv',
    ('8', '1'): '<vv',
    ('8', '2'): 'vv',
    ('8', '3'): 'vv>',
    ('8', '4'): '<v',
    ('8', '5'): 'v',
    ('8', '6'): '>v',
    ('8', '7'): '<',
    ('8', '8'): '',
    ('8', '9'): '>',
    ('9', 'A'): 'vvv',
    ('9', '0'): 'vvv<',
    ('9', '1'): '<<vv',
    ('9', '2'): '<vv',
    ('9', '3'): 'vv',
    ('9', '4'): '<<v',
    ('9', '5'): '<v',
    ('9', '6'): 'v',
    ('9', '7'): '<<',
    ('9', '8'): '<',
    ('9', '9'): '',
}

dir_move_map = {
    ('<', 'v'): '>',
    ('<', '^'): '>^',
    ('<', '>'): '>>',
    ('<', 'A'): '>>^',
    ('v', '<'): '<',
    ('v', '>'): '>',
    ('v', '^'): '^',
    ('v', 'A'): '^>',
    ('^', 'v'): 'v',
    ('^', '<'): 'v<',
    ('^', '>'): 'v>',
    ('^', 'A'): '>',
    ('>', '<'): '<<',
    ('>', 'v'): '<',
    ('>', '^'): '<^',
    ('>', 'A'): '^',
    ('A', '<'): 'v<<',
    ('A', 'v'): 'v<',
    ('A', '^'): '<',
    ('A', '>'): 'v',
    ('A', 'A'): '',
    ('<', '<'): '',
    ('>', '>'): '',
    ('^', '^'): '',
    ('v', 'v'): ''
}

def day21data(file):
    return file.read().decode('utf-8').splitlines()

def part1(data, num_robots = 2):
    result = 0
    for line in data:
        moves, move_len = generate_0(line)
        print (moves)
        moves, move_len = generate_1(moves, num_robots - 1)
        print (f"Moves: {moves}, length: {move_len}")
        result += len(moves) * int(line[:-1])
    return result

def generate_0(sequence):
    xsequence = 'A' + sequence
    moves = ''
    for i in range(len(xsequence) - 1):
        prev_key = xsequence[i]
        key = xsequence[i+1]
        moves += keypad_move_map[(prev_key, key)] + 'A'
    return moves, len(moves)

def generate_1(sequence, generation):
    moves = ''
    print (f"Sequence: {sequence}")
    if not generation:
        xsequence = 'A' + sequence
        for i in range(len(xsequence) - 1):
            prev_key = xsequence[i]
            key = xsequence[i+1]
            moves += dir_move_map[(prev_key, key)]
            moves += 'A'
    else:
        xsequence = sequence
        for i in range(len(xsequence) - 1):
            prev_key = xsequence[i]
            key = xsequence[i+1]
            move, _ = generate_1(prev_key + key, generation - 1)
            moves += move + 'A'
    print (f"Moves: {moves}")
    return moves, len(moves)
